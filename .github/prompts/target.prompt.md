
---
title: ACL Keep Health - 系統設計與實現細節
description: 案場保養與照片輸出系統
updated: 2025-10-30
frontend: React Web + PWA
---

# ACL Keep Health 系統設計與實現細節

## 系統概述

整個系統區分為四大塊：**案場管理**、**用戶認證**、**保養系統**、**輸出系統**。

前端採用純 **React 網頁框架**並實作 **PWA**（可安裝至手機主畫面），同時滿足：
- Android 使用者可直接安裝 PWA 作為應用程式
- iOS 使用者透過 Safari「加入主畫面」安裝 PWA

## 部署架構

- **前端**：Cloudflare Pages（靜態資產 + PWA）
- **後端**：Cloudflare Workers（API 伺服器）
- **資料層**：Supabase（資料庫、驗證、Storage）

**重要原則**：前端僅呼叫後端 API，不直接連接 Supabase。

## 使用流程

### 1. 登入與案場列表
用戶登入後，進入**案場列表頁面**，顯示所有案場卡片。

案場列表頁面導航欄（僅兩項）：
- **案場列表**：當前頁面（已激活）
- **帳戶設定**：進入帳戶設定頁面

### 2. 進入案場
點擊任一案場卡片，進入該案場的**案場詳情頁面**。

進入案場後，下方固定出現導覽列，包含以下五項功能：

#### 案場詳情頁導覽列
- **案場列表**：回到所有案場卡片頁面
- **保養開始**：進入保養表單，預設帶入該案場資訊
- **保養記錄**：顯示該案場所有保養紀錄（含縮圖預覽），可點擊查看詳細與照片
- **案場管理**：可編輯該案場的資訊（名稱、地址、檢查單位）
- **輸出照片**：進入該案場的照片輸出頁面

### 3. 保養表單填寫
進入「保養開始」頁面，填寫保養表單。

表單欄位包含：
- 樓層
- 維運系統
- 保養內容
- 保養備註
- 保養日期
- 保養人員
- 圖片上傳（支援多張，由後端 API 存入 Supabase Storage）

填寫完成後，由後端 API 將資料寫入 Supabase 資料庫。

### 4. 保養記錄查看
「保養記錄」頁面顯示該案場所有保養紀錄，含縮圖預覽。可點擊查看詳細資訊與照片。

### 5. 照片輸出
進入「輸出照片」頁面，執行以下操作：

1. **重新命名**：每張照片需重新命名，檔名格式為：
   ```
   維運系統_保養內容_保養備註_保養人員_流水號.jpg
   ```

2. **分類**：依「維運系統」建立資料夾分類

3. **打包下載**：最後打包為 ZIP 供下載（前端打包或由後端產生下載連結，依最終效能/安全決策規劃）

### 6. 帳戶設定
進入「帳戶設定」頁面，使用者可以：

- 設定基本資訊（姓名、電子郵件、密碼）
- 變更密碼
- 綁定 LINE 帳號以支援 LINE 登入（流程由後端 API 串接）
- 登出帳戶

## 設計原則

### 使用者體驗
- 操作簡單直觀
- 頁面切換流暢
- 對行動裝置友善（RWD）
- 具備 PWA 安裝提示
- 離線體驗（關鍵頁面快取、網路失敗替代頁）

### 後端設計
- 確保資料安全性與完整性
- 有效率地處理大量資料存取
- 所有 API 請求需驗證用戶身份（JWT / Session / 其他憑證）
- 依 RLS 政策與權限控管驗證存取

---

## 開發規範

### 基本原則
1. **開發順序**：先完成前端畫面與互動流程（React Web + PWA），再進行後端 API 設計與實作
2. **前後分離**：不要前端與後端同時開發，以免需求變動導致重工
3. **型別安全**：使用 TypeScript 確保型別安全

### 前端技術棧
4. **框架**：React（建議 Vite 作為建置工具）
   - 提供 manifest.json、Service Worker（Workbox 或自訂策略）
   - 支援安裝提示（Add to Home Screen）與離線快取策略（App Shell + 重要頁面/資源）
   - 採用 React Router 進行路由（SPA），並注意 RWD 與可存取性（a11y）
5. **UI 元件庫**：Ant Design（antd，Web 版）以確保一致設計風格
   - 共用導覽列、表單欄位、卡片元件等需抽離為獨立組件

### 後端技術棧
6. **服務**：Cloudflare Workers 提供 API
7. **資料層**：Supabase（資料庫、驗證、Storage）

### 部署
8. **前端部署**：Cloudflare Pages（靜態資產 + PWA）
9. **後端部署**：Cloudflare Workers

### 版本控制
10. **版本控制**：使用 Git，遵循 Git Flow
11. **提交說明**：變更需撰寫簡要說明（含影響範圍）

### 安全性
12. **API 存取**：前端僅透過後端 API 溝通，不可直接存取 Supabase
13. **權限控管**：只有後端可存取 Supabase，並依 RLS 政策與權限控管驗證存取
14. **身份驗證**：所有 API 請求需驗證用戶身份（JWT / Session / 其他憑證），避免未授權存取
15. **敏感資訊**：不要在前端暴露敏感資訊（金鑰、服務角色憑證等）

### 效能與可觀測性
16. **圖片處理**：圖片上傳前可選擇壓縮/轉檔（於前端或後端處理）
17. **下載打包**：考量檔名規則與資料夾結構一致性
18. **後端記錄**：於後端端點加入基本記錄（請求追蹤、錯誤記錄）
19. **前端記錄**：以最小化紀錄錯誤並避免洩漏敏感資訊